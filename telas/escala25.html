<!DOCTYPE html>
<html>

<head>
  <meta charset="ISO-8859-1">
  <title>Testes</title>
  <link rel="stylesheet" href="./css/escalasC.css">
  <link rel="stylesheet" href="./estilos/menu.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
</head>

<body>
  <script src="./scripts/header.js"></script>
  <form id="formPage3">
    <label for="comentarioDM2">Coment√°rio:</label>
    <textarea id="comentarioDM2" rows="4" cols="50" required></textarea>

    <button type="button" onclick="saveDataAndSubmit()">Salvar</button>
  </form>
  <script>
    function saveDataAndSubmit() {
      
      const op2_1 = parseInt(localStorage.getItem('op2_1'));
      const op2_2 = parseInt(localStorage.getItem('op2_2'));
      const op2_3 = parseInt(localStorage.getItem('op2_3'));
      const op2_4 = parseInt(localStorage.getItem('op2_4'));
      const op2_5 = parseInt(localStorage.getItem('op2_5'));
      const op2_6 = parseInt(localStorage.getItem('op2_6'));
      const op2_7 = parseInt(localStorage.getItem('op2_7'));
      const op2_8 = parseInt(localStorage.getItem('op2_8'));
      const cpfPacEscala = localStorage.getItem('cpfPacEscala'); 

      const somaDM2 = op2_1 + op2_2 + op2_3 + op2_4 + op2_5 + op2_6 + op2_7 + op2_8;

      localStorage.setItem('comentarioDM2', document.getElementById('comentarioDM2').value);

      const data = {
        op2_1: op2_1,
        op2_2: op2_2,
        op2_3: op2_3,
        op2_4: op2_4,
        op2_5: op2_5,
        op2_6: op2_6,
        op2_7: op2_7,
        op2_8: op2_8,
        somaDM2: somaDM2,
        comentarioDM2: localStorage.getItem('comentarioDM2'),
        cpf_paciente: cpfPacEscala
      };

      console.log(cpfPacEscala)
      
      

      fetch('http://localhost:8080/auth/registraEscala2', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(data),
      })
      .then(response => response.json())
      .then(data => {
        
        alert('Dados enviados com sucesso!');

        for (let key in localStorage) {
         if (key !== 'cpfPacEscala') {
        localStorage.removeItem(key);
        }
        
    }

      

        window.location.href = 'escala31.html';
      })
      .catch(error => {
        console.error('Erro ao enviar dados:', error);
        alert('Erro ao enviar dados. Por favor, tente novamente.');
      });
    }
  </script>
</body>
</html>
