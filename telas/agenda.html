<!DOCTYPE html>
<html>

<head>
	<meta charset="ISO-8859-1">
	<title>EquoSoft</title>
	<link rel="shortcut icon" href="./img/equo_LOGO.png">
	<link rel="stylesheet" href="estilos/consulta.css">
	<link rel="stylesheet" href="estilos/menu.css">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.min.css">
</head>

<body>
	<script src="./scripts/header.js"></script>

	<div class="instituicao">
		<p>Instituição: XXXXX</p>
	</div>
	<div class="divtb">
		<h1 class="title">Agenda</h1>
		<table>
			<tbody>
				<tr id="consulta-list"></tr>
			</tbody>
		</table>
	</div>

	<script>
		function editarConsulta(idConsulta) {
			console.log("Editar consulta com ID: `${idConsulta}`");
		}

		function deletarConsulta(id) {
			fetch(`http://localhost:8080/auth/consultas/${id}`, {
				method: 'DELETE'
			})
				.then(response => {
					if (response.status === 204) {
						window.location.replace("agenda.html");
					} else {
						console.error('Erro ao excluir consulta.');
					}
				});
		}

		document.addEventListener("DOMContentLoaded", function () {
			carregarConsultas();

			function carregarConsultas() {
				fetch("http://localhost:8080/auth/consulta")
					.then(response => response.json())
					.then(data => exibirConsultas(data));
			}

			function exibirConsultas(consulta) {
				const consultalist = document.getElementById("consulta-list");
				consultalist.innerHTML = "";

				consulta.forEach(consulta => {
					const consultaItem = document.createElement("td");
					consultaItem.classList.add("consulta-item");

					consultaItem.innerHTML = `
                        ${consulta.nome}
                        <button class="tdeditar" onclick="editarconsulta(${consulta.id_consulta})">Editar</button>
                        <button class="tdexcluir" onclick="deletarconsulta(${consulta.id_consulta})">Deletar</button>
                    `;

					consultaList.appendChild(consultaItem);
				});
			}
		});
	</script>
</body>

</html>
