<!DOCTYPE html>
<html>
<head>
    <meta charset="ISO-8859-1">
    <title>EquoSoft</title>
    <link rel="shortcut icon" href="./img/equo_LOGO.png">
    <link rel="stylesheet" href="estilos/consulta.css">
    <link rel="stylesheet" href="estilos/menu.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.min.css">
</head>
<body>
	<script src="./scripts/header.js"></script>

    <div class="instituicao">
        <p>Instituição: XXXXX</p>
    </div>
    <div class="divtb">
        <h1 class="title">Pacientes</h1>
        <table>
            <tbody>
                <tr id="pacientes-list"></tr>
            </tbody>
        </table>
    </div>

    <script>
        // Move as funções para o escopo global
        function editarPaciente(idPaciente) {
            // Implemente a lógica de edição conforme necessário
            console.log(`Editar paciente com ID: ${idPaciente}`);
        }

        function deletarPaciente(id) {
            // Implemente a lógica de exclusão conforme necessário
			let confirma = confirm("Deseja Excluir este paciente?")
			if(confirma){
				fetch(`http://localhost:8080/auth/pacientes/${id}`, {
					method: 'DELETE'
				})
				.then(response => {
					if (response.status === 204) {
						window.location.replace("consulta.html");
					} else {
						console.error('Erro ao excluir paciente.');
					}
				});
			}
        }

        document.addEventListener("DOMContentLoaded", function () {
            carregarPacientes();

            function carregarPacientes() {
                fetch("http://localhost:8080/auth/pacientes")
                    .then(response => response.json())
                    .then(data => exibirPacientes(data));
            }

            function exibirPacientes(pacientes) {
                const pacientesList = document.getElementById("pacientes-list");
                pacientesList.innerHTML = "";

                pacientes.forEach(paciente => {
                    const pacienteItem = document.createElement("td");
                    pacienteItem.classList.add("paciente-item");

                    pacienteItem.innerHTML = `
                        <p>${paciente.nome_paciente}</p>
                        <button class="tdeditar" onclick="editarPaciente(${paciente.id_paciente})">Editar</button>
                        <button class="tdexcluir" onclick="deletarPaciente(${paciente.id_paciente})">Deletar</button>
                    `;

                    pacientesList.appendChild(pacienteItem);
                });
            }
        });
    </script>   
</body>
</html>
