<!DOCTYPE html>
<html>

<head>
  <meta charset="ISO-8859-1">
  <title>Testes</title>
  <link rel="stylesheet" href="./css/escalasC.css">
  <link rel="stylesheet" href="./estilos/menu.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
</head>

<body>
  <script src="./scripts/header.js"></script>
  <form id="formPage3">
    <label for="comentarioDM1">Coment√°rio:</label>
    <textarea id="comentarioDM1" rows="4" cols="50" required></textarea>

    <button type="button" onclick="saveDataAndSubmit()">Salvar</button>
  </form>

  <script>
    function saveDataAndSubmit() {
      
      const op1_1 = parseInt(localStorage.getItem('op1_1'));
      const op1_2 = parseInt(localStorage.getItem('op1_2'));
      const op1_3 = parseInt(localStorage.getItem('op1_3'));
      const op1_4 = parseInt(localStorage.getItem('op1_4'));
      const cpfPacEscala = localStorage.getItem('cpfPacEscala'); 

      const somaDM1 = op1_1 + op1_2 + op1_3 + op1_4;

      localStorage.setItem('comentarioDM1', document.getElementById('comentarioDM1').value);

      const data = {
        op1_1: op1_1,
        op1_2: op1_2,
        op1_3: op1_3,
        op1_4: op1_4,
        somaDM1: somaDM1,
        comentarioDM1: localStorage.getItem('comentarioDM1'),
        cpf_paciente: cpfPacEscala
      };

      console.log(cpfPacEscala)
      
      

      fetch('http://localhost:8080/auth/registraEscala1', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(data),
      })
      .then(response => response.json())
      .then(data => {
        console.log('Dados enviados com sucesso:', data);
        alert('Dados enviados com sucesso!');

        for (let key in localStorage) {
         if (key !== 'cpfPacEscala') {
        localStorage.removeItem(key);
        }
        
    }

      

        window.location.href = 'escala21.html';
      })
      .catch(error => {
        console.error('Erro ao enviar dados:', error);
        alert('Erro ao enviar dados. Por favor, tente novamente.');
      });
    }
  </script>
</body>
</html>
